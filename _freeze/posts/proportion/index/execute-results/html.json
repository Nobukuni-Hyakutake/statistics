{
  "hash": "081beda3b05a20550fbd703da4a462ef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"比率の推定・検定\"\nauthor: \"Nobukuni Hyakutake\"\ndate: \"2025-06-11\"\ndate-format: \"iso\"\ncategories: [Python]\nimage: \"field_mustard.jpeg\"\n---\n\n![](field_mustard.jpeg)\n\n## 母集団比率の区間推定\n\n$\\hat{p}=0$の場合\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nnmax <- 300\nalpha <- 0.05\n\ndf_n <- tibble(n = seq(2, nmax))\n\ndf0 <- df_n |>\n  mutate(p2 = qf(alpha, 2, 2 * n, lower.tail = FALSE) / (n + qf(alpha, 2, 2 *\n                                                                  n, lower.tail = FALSE)))\n\nggplot(df0, aes(x = n, y = p2)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n$\\hat{p}≠0$の場合\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- 1\ndf2 <- df_n |>\n  mutate(\n    F1 = qf(alpha/2, 2 * (n - x + 1), 2 * x, lower.tail = FALSE),\n    F2 = qf(alpha/2, 2 * (x + 1), 2 * (n - x), lower.tail = FALSE),\n    p1 = x / ((n - x + 1) * F1 + x),\n    p2 = (x + 1) * F2 / ((x + 1) * F2 + (n - x))\n  )\nggplot(df2, aes(x = n, y = p2)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n## 比率の検定\n\n- $H_0:p=p_0,H_1:p>p_0$の場合\n\n\n::: {.cell}\n\n```{.r .cell-code}\npmax <- 0.95\ndf_p <- tibble(p = seq(0, pmax, 0.01))\ndf1 <- cross_join(df_n, df_p)\n\nx <- 1\ndf3 <- df1 |>\n  mutate(\n    c = 2 * (n - x + 1),\n    d = 2 * x,\n    f2 = d * (1 - p) / (c * p),\n    F2 = qf(alpha, c, d, lower.tail = FALSE),\n    significant = (f2 >= F2)\n  )\n\nggplot(df3, aes(x = n, y = p, colour = significant)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n- $H_0:p=p_0,H_1:p≠p_0$の場合\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- 1\ndf4 <- df1 |>\n  mutate(\n    a = 2 * (x + 1),\n    b = 2 * (n - x),\n    f1 = b * p / (a * (1 - p)),\n    c = 2 * (n - x + 1),\n    d = 2 * x,\n    f2 = d * (1 - p) / (c * p),\n    F1 = qf(alpha / 2, a, b, lower.tail = FALSE),\n    F2 = qf(alpha / 2, c, d, lower.tail = FALSE),\n    significant = (f1 >= F1) | (f2 >= F2)\n  )\n\nggplot(df4, aes(x = n, y = p, colour = significant)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n- $H_0:p=p_0,H_1:p<p_0$の場合\n\n\n::: {.cell}\n\n```{.r .cell-code}\nalpha <- 0.05/2\nx <- 1\ndf5 <- df1 |>\n  mutate(\n    a = 2 * (x + 1),\n    b = 2 * (n - x),\n    f1 = b * p / (a * (1 - p)),\n    F1 = qf(alpha, a, b, lower.tail = FALSE),\n    significant = (f1 >= F1)\n  )\n\nggplot(df5, aes(x = n, y = p, colour = significant)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n上記の境界線を計算して$\\hat{p}≠0$の場合の信頼区間上限と比較する\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf6 <- df5 |>\n  filter(!significant) |>\n  group_by(n) |>\n  summarise(pmax = max(p))\n\nggplot(df6, aes(x = n, y = pmax)) +\n  geom_point(colour=\"black\")+\n  geom_point(data=df2,aes(x=n,y=p2),colour=\"red\",alpha=0.5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n概ね一致している。\n\n## 参考文献\n\n- [統計解析ハンドブック 普及版](https://www.asakura.co.jp/detail.php?book_code=12182&srsltid=AfmBOoo-9U66C-D7qSWWIgn5pQ5pqxlJUky1PhdgrE9eHjM07pfxxnQR)\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR.version.string\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"R version 4.4.0 (2024-04-24)\"\n```\n\n\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}