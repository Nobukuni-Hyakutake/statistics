{
  "hash": "06c63b47d20b1517c87afcb328051ebc",
  "result": {
    "markdown": "---\ntitle: \"ワイブル分布の確率密度関数への近似\"\nauthor: \"Nobukuni Hyakutake\"\ndate: \"2023-02-20\"\ndate-format: \"iso\"\ncategories: [R,Python]\n---\n\n\n![](aqua.jpeg)\n\n# 目的\n\n寿命データを最尤推定法でワイブル分布の確率密度関数に近似します。\n\n# 解析するデータの読み込み\n\n寿命のデータ\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(plotly)\nlibrary(gt)\ndsu01<-read_csv(\"\n  life\n  28\n  30\n  32\n  30\n  25\n  27\n  24\n  23\n  29\n  29\n  29\n  31\n  38\n  33\n  32\n  29\n  30\n  18\n  28\n  28\n  24\n  23\n  28\n  29\n  27\n  26\n  28\n  28\n  28\n  27\n  \",show_col_types = FALSE\n)\ndsu11<-count(dsu01,life) |> \n  mutate(n=n/sum(n))\nf1<-plot_ly(x=dsu11$life,y=dsu11$n,type='bar',name=\"Actual\")\nf1\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-69cf3d972d9e40469968\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-69cf3d972d9e40469968\">{\"x\":{\"visdat\":{\"4b2351d2a4ca\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"4b2351d2a4ca\",\"attrs\":{\"4b2351d2a4ca\":{\"x\":[18,23,24,25,26,27,28,29,30,31,32,33,38],\"y\":[0.0333333333333333,0.0666666666666667,0.0666666666666667,0.0333333333333333,0.0333333333333333,0.1,0.233333333333333,0.166666666666667,0.1,0.0333333333333333,0.0666666666666667,0.0333333333333333,0.0333333333333333],\"name\":\"Actual\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"bar\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":[]},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":[]},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[18,23,24,25,26,27,28,29,30,31,32,33,38],\"y\":[0.0333333333333333,0.0666666666666667,0.0666666666666667,0.0333333333333333,0.0333333333333333,0.1,0.233333333333333,0.166666666666667,0.1,0.0333333333333333,0.0666666666666667,0.0333333333333333,0.0333333333333333],\"name\":\"Actual\",\"type\":\"bar\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n# ワイブル分布の確率密度関数\n\n下記式のηとmを最尤推定します。\n\n$$\nf(t)=\\frac{m}{\\eta}\\left(\\frac{t}{\\eta}\\right)^{m-1}e^{-\\left(\\frac{t}{\\eta}\\right)^m}\n$$\n\n# Rでのワイブル近似\n\n## パッケージの読み込み\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\n```\n:::\n\n\n## ワイブルのパラメーターを算出\n\nsurvregを使う。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt<-survreg(Surv(dsu01$life)~1, dist=\"weibull\")\n```\n:::\n\n\nsurvregの結果は、上述の確率密度関数のパラメーターとして使うには換算する必要がある。\n\n$m$ \n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_fit<-1/t$scale\nm_fit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 8.057331\n```\n:::\n:::\n\n\n$\\eta$\n\n\n::: {.cell}\n\n```{.r .cell-code}\neta_fit<-exp(unname(t$coefficients))\neta_fit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.57896\n```\n:::\n:::\n\n\n## グラフ化\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntsr<-c(1:max(dsu01$life))\nttr<-str_c(\"Scale parameter η: \",as.character(round(eta_fit,3)),\", Shape parameter m: \",as.character(round(m_fit,3)))\nf2<-f1|> \n  add_trace(x=tsr,y=dweibull(tsr,shape=m_fit,scale=eta_fit),type=\"scatter\",mode=\"line\",name=\"Weibull fit\") |>\n  layout(title=\"Weibull fit with 'survival' package - R\") |> \n  add_annotations(\n    x= 0.03,\n    y= 0.95,\n    xref = \"paper\",\n    yref = \"paper\",\n    text = ttr,\n    showarrow=FALSE)\nf2\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-3e2990945a703bffd911\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3e2990945a703bffd911\">{\"x\":{\"visdat\":{\"4b2351d2a4ca\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"4b2351d2a4ca\",\"attrs\":{\"4b2351d2a4ca\":{\"x\":[18,23,24,25,26,27,28,29,30,31,32,33,38],\"y\":[0.0333333333333333,0.0666666666666667,0.0666666666666667,0.0333333333333333,0.0333333333333333,0.1,0.233333333333333,0.166666666666667,0.1,0.0333333333333333,0.0666666666666667,0.0333333333333333,0.0333333333333333],\"name\":\"Actual\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"bar\"},\"4b2351d2a4ca.1\":{\"x\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],\"y\":[1.13238701652436e-11,1.50821497525071e-09,2.63753100437017e-08,2.00877628693453e-07,9.70191374147673e-07,3.51289208982579e-06,1.04262389923219e-05,2.67539830195499e-05,6.14285795380645e-05,0.000129198177770701,0.000253103299268035,0.000467553901279546,0.000822025412906788,0.00138532628337209,0.00225026331954211,0.00353830460625997,0.00540345726448282,0.008033970239261,0.0116495760096223,0.0164907824436752,0.0227953403535159,0.0307558739529034,0.0404527538273805,0.0517594104429517,0.0642260618328559,0.0769649552064973,0.0885859900531846,0.0972590483977193,0.100988364533984,0.0981407102432582,0.0881420808916129,0.0720645263546774,0.0526858129449,0.0337247904174444,0.0184407477164268,0.00836981161336808,0.00305016346954716,0.00085892578530151],\"name\":\"Weibull fit\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\",\"mode\":\"line\",\"inherit\":true}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"title\":\"Weibull fit with 'survival' package - R\",\"annotations\":[{\"text\":\"Scale parameter η: 29.579, Shape parameter m: 8.057\",\"x\":0.03,\"y\":0.95,\"xref\":\"paper\",\"yref\":\"paper\",\"showarrow\":false}],\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":[]},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":[]},\"hovermode\":\"closest\",\"showlegend\":true},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[18,23,24,25,26,27,28,29,30,31,32,33,38],\"y\":[0.0333333333333333,0.0666666666666667,0.0666666666666667,0.0333333333333333,0.0333333333333333,0.1,0.233333333333333,0.166666666666667,0.1,0.0333333333333333,0.0666666666666667,0.0333333333333333,0.0333333333333333],\"name\":\"Actual\",\"type\":\"bar\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null},{\"x\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],\"y\":[1.13238701652436e-11,1.50821497525071e-09,2.63753100437017e-08,2.00877628693453e-07,9.70191374147673e-07,3.51289208982579e-06,1.04262389923219e-05,2.67539830195499e-05,6.14285795380645e-05,0.000129198177770701,0.000253103299268035,0.000467553901279546,0.000822025412906788,0.00138532628337209,0.00225026331954211,0.00353830460625997,0.00540345726448282,0.008033970239261,0.0116495760096223,0.0164907824436752,0.0227953403535159,0.0307558739529034,0.0404527538273805,0.0517594104429517,0.0642260618328559,0.0769649552064973,0.0885859900531846,0.0972590483977193,0.100988364533984,0.0981407102432582,0.0881420808916129,0.0720645263546774,0.0526858129449,0.0337247904174444,0.0184407477164268,0.00836981161336808,0.00305016346954716,0.00085892578530151],\"name\":\"Weibull fit\",\"type\":\"scatter\",\"mode\":\"line\",\"marker\":{\"color\":\"rgba(255,127,14,1)\",\"line\":{\"color\":\"rgba(255,127,14,1)\"}},\"error_y\":{\"color\":\"rgba(255,127,14,1)\"},\"error_x\":{\"color\":\"rgba(255,127,14,1)\"},\"line\":{\"color\":\"rgba(255,127,14,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## 複数タイプから一気にηとmを計算\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt3<-read_csv(\"\ntype,life\na,5\nb,4\na,5\na,6\nb,3\nb,2\na,4\nb,2\n\",show_col_types = FALSE)\n\nt4<-split(t3,t3$type)\n\nmm2<-function(i){\n  t<-survreg(Surv(i$life)~1, dist=\"weibull\")\n  t1<-tibble(eta=exp(unname(t$coefficients)),m=1/t$scale)\n  return(t1)\n}\n\nqq3<-map(t4,mm2) |> \n  bind_rows(.id=\"id\") |> \n  rename(type=id) |> \n  arrange(type)\ngt(qq3)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"oybfgwhdap\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#oybfgwhdap .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#oybfgwhdap .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#oybfgwhdap .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#oybfgwhdap .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#oybfgwhdap .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#oybfgwhdap .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#oybfgwhdap .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#oybfgwhdap .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#oybfgwhdap .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#oybfgwhdap .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#oybfgwhdap .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#oybfgwhdap .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#oybfgwhdap .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#oybfgwhdap .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oybfgwhdap .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#oybfgwhdap .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#oybfgwhdap .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oybfgwhdap .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#oybfgwhdap .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oybfgwhdap .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#oybfgwhdap .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oybfgwhdap .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#oybfgwhdap .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oybfgwhdap .gt_left {\n  text-align: left;\n}\n\n#oybfgwhdap .gt_center {\n  text-align: center;\n}\n\n#oybfgwhdap .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#oybfgwhdap .gt_font_normal {\n  font-weight: normal;\n}\n\n#oybfgwhdap .gt_font_bold {\n  font-weight: bold;\n}\n\n#oybfgwhdap .gt_font_italic {\n  font-style: italic;\n}\n\n#oybfgwhdap .gt_super {\n  font-size: 65%;\n}\n\n#oybfgwhdap .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#oybfgwhdap .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#oybfgwhdap .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#oybfgwhdap .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#oybfgwhdap .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#oybfgwhdap .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#oybfgwhdap .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"type\">type</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"eta\">eta</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"m\">m</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"type\" class=\"gt_row gt_left\">a</td>\n<td headers=\"eta\" class=\"gt_row gt_right\">5.308623</td>\n<td headers=\"m\" class=\"gt_row gt_right\">7.975578</td></tr>\n    <tr><td headers=\"type\" class=\"gt_row gt_left\">b</td>\n<td headers=\"eta\" class=\"gt_row gt_right\">3.058647</td>\n<td headers=\"m\" class=\"gt_row gt_right\">3.613229</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n\n## R version\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR.version.string\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"R version 4.2.2 (2022-10-31)\"\n```\n:::\n:::\n\n# Pythonでのワイブル近似\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport pandas as pd\nfrom reliability.Fitters import Fit_Weibull_2P\nimport plotly.graph_objects as go\n```\n:::\n\n\n\n## 関数定義\n\npythonはワイブル関数の自作が必要\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef weibull_d(m,t,eta):\n  k=(m/eta)*(t/eta)**(m-1)*np.exp(-1*((t/eta)**m))\n  return k\n```\n:::\n\n\n## フィット\n\n結果詳細。Alphaは尺度パラメーターη、Betaは形状パラメーターmに相当する。\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndsu02=r.dsu01\nlife_max=int(max(dsu02['life']))\ndsu03=dsu02['life'].values.tolist()\nwb2 = Fit_Weibull_2P(failures=dsu03)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\u001b[1m\u001b[23m\u001b[4m\u001b[49m\u001b[39mResults from Fit_Weibull_2P (95% CI):\u001b[0m\nAnalysis method: Maximum Likelihood Estimation (MLE)\nOptimizer: TNC\nFailures / Right censored: 30/0 (0% right censored) \n\nParameter  Point Estimate  Standard Error  Lower CI  Upper CI\n    Alpha          29.579        0.709558   28.2204   31.0029\n     Beta         8.05733         1.02419   6.28047   10.3369 \n\nGoodness of fit    Value\n Log-likelihood -82.1756\n           AICc  168.796\n            BIC  171.154\n             AD  1.48179 \n```\n:::\n:::\n\n\n## グラフ化\n\n\n::: {.cell}\n\n```{.python .cell-code}\ntt=\"Scale parameter η: \"+str(round(wb2.alpha,3))+\", Shape parameter m: \"+str(round(wb2.beta,3))\nts=np.arange(1,life_max+1)\nta=r.dsu11\nfig0201=go.Bar(\n        x=ta['life'], y=ta[\"n\"],name='Actual',\n        marker={\"color\": \"blue\"}\n        )\nfig0202=go.Scatter(\n        x=ts, y=weibull_d(wb2.beta,ts,wb2.alpha), name='Weibull fit',\n        line={\"color\": \"orange\"},\n    )\nlayout=go.Layout(\n        title={\"text\":\"Weibull fit with 'leliability' package - Python \"})\nfig04=go.Figure(data=[fig0201,fig0202],layout=layout)\nfig04=fig04.update_layout(annotations=[\n  go.layout.Annotation(\n    xref=\"paper\",\n    yref=\"paper\",\n    x=0.03,\n    y=0.95,\n    showarrow=False,\n    text=tt\n)\n])\nfig04\n```\n\n::: {.cell-output-display}\n```{=html}\n<div>                        <script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>\n        <script src=\"https://cdn.plot.ly/plotly-2.14.0.min.js\"></script>                <div id=\"295a1f0d-2f6e-4e4b-b9a0-d1936c759ceb\" class=\"plotly-graph-div\" style=\"height:100%; width:100%;\"></div>            <script type=\"text/javascript\">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"295a1f0d-2f6e-4e4b-b9a0-d1936c759ceb\")) {                    Plotly.newPlot(                        \"295a1f0d-2f6e-4e4b-b9a0-d1936c759ceb\",                        [{\"marker\":{\"color\":\"blue\"},\"name\":\"Actual\",\"x\":[18.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,38.0],\"y\":[0.03333333333333333,0.06666666666666667,0.06666666666666667,0.03333333333333333,0.03333333333333333,0.1,0.23333333333333334,0.16666666666666666,0.1,0.03333333333333333,0.06666666666666667,0.03333333333333333,0.03333333333333333],\"type\":\"bar\"},{\"line\":{\"color\":\"orange\"},\"name\":\"Weibull fit\",\"x\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],\"y\":[1.1323946539681028e-11,1.5082230276621622e-09,2.637542917727607e-08,2.0087841884913633e-07,9.7019475142361e-07,3.512903019612673e-06,1.0426268172667666e-05,2.6754050651741873e-05,6.142872014792959e-05,0.00012919844587711777,0.00025310377548923556,0.0004675546982099255,0.000822026679765255,0.0013853282079881854,0.0022502661256794776,0.003538308543570744,0.005403462587596613,0.008033977171833412,0.011649584689049298,0.016490792843479783,0.022795352184524473,0.03075588655313065,0.040452766065810025,0.051759420684160944,0.06422606803267603,0.07696495521898575,0.08858598219894565,0.09725903223996817,0.10098834162083929,0.0981406843670262,0.08814205737231402,0.07206451021851425,0.052685806676814134,0.03372479271200665,0.01844075439277052,0.008369818256685433,0.003050167741266745,0.0008589276986255127],\"type\":\"scatter\"}],                        {\"title\":{\"text\":\"Weibull fit with 'leliability' package - Python \"},\"template\":{\"data\":{\"histogram2dcontour\":[{\"type\":\"histogram2dcontour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"choropleth\":[{\"type\":\"choropleth\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"histogram2d\":[{\"type\":\"histogram2d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmap\":[{\"type\":\"heatmap\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"heatmapgl\":[{\"type\":\"heatmapgl\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"contourcarpet\":[{\"type\":\"contourcarpet\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"contour\":[{\"type\":\"contour\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"surface\":[{\"type\":\"surface\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]}],\"mesh3d\":[{\"type\":\"mesh3d\",\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}],\"scatter\":[{\"fillpattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2},\"type\":\"scatter\"}],\"parcoords\":[{\"type\":\"parcoords\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolargl\":[{\"type\":\"scatterpolargl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"bar\":[{\"error_x\":{\"color\":\"#2a3f5f\"},\"error_y\":{\"color\":\"#2a3f5f\"},\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"scattergeo\":[{\"type\":\"scattergeo\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterpolar\":[{\"type\":\"scatterpolar\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"scattergl\":[{\"type\":\"scattergl\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatter3d\":[{\"type\":\"scatter3d\",\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattermapbox\":[{\"type\":\"scattermapbox\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scatterternary\":[{\"type\":\"scatterternary\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"scattercarpet\":[{\"type\":\"scattercarpet\",\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}}}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"baxis\":{\"endlinecolor\":\"#2a3f5f\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"minorgridcolor\":\"white\",\"startlinecolor\":\"#2a3f5f\"},\"type\":\"carpet\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#EBF0F8\"},\"line\":{\"color\":\"white\"}},\"header\":{\"fill\":{\"color\":\"#C8D4E3\"},\"line\":{\"color\":\"white\"}},\"type\":\"table\"}],\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"#E5ECF6\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}]},\"layout\":{\"autotypenumbers\":\"strict\",\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#2a3f5f\"},\"hovermode\":\"closest\",\"hoverlabel\":{\"align\":\"left\"},\"paper_bgcolor\":\"white\",\"plot_bgcolor\":\"#E5ECF6\",\"polar\":{\"bgcolor\":\"#E5ECF6\",\"angularaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"radialaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"ternary\":{\"bgcolor\":\"#E5ECF6\",\"aaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"},\"caxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\"}},\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]]},\"xaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"yaxis\":{\"gridcolor\":\"white\",\"linecolor\":\"white\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"white\",\"automargin\":true,\"zerolinewidth\":2},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"yaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2},\"zaxis\":{\"backgroundcolor\":\"#E5ECF6\",\"gridcolor\":\"white\",\"linecolor\":\"white\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"white\",\"gridwidth\":2}},\"shapedefaults\":{\"line\":{\"color\":\"#2a3f5f\"}},\"annotationdefaults\":{\"arrowcolor\":\"#2a3f5f\",\"arrowhead\":0,\"arrowwidth\":1},\"geo\":{\"bgcolor\":\"white\",\"landcolor\":\"#E5ECF6\",\"subunitcolor\":\"white\",\"showland\":true,\"showlakes\":true,\"lakecolor\":\"white\"},\"title\":{\"x\":0.05},\"mapbox\":{\"style\":\"light\"}}},\"annotations\":[{\"showarrow\":false,\"text\":\"Scale parameter \\u03b7: 29.579, Shape parameter m: 8.057\",\"x\":0.03,\"xref\":\"paper\",\"y\":0.95,\"yref\":\"paper\"}]},                        {\"responsive\": true}                    )                };                            </script>        </div>\n```\n:::\n:::\n\n\n## 複数タイプから一気にηとmを計算\n\n\n::: {.cell}\n\n```{.python .cell-code}\npt1=pd.DataFrame([\n[\"a\",5],\n[\"b\",4],\n[\"a\",5],\n[\"a\",6],\n[\"b\",3],\n[\"b\",2],\n[\"a\",4],\n[\"b\",2]\n])\npt1.columns=[\"type\",\"life\"]\npt2=pt1.drop_duplicates(\"type\")\n```\n:::\n\n\n### タイプごとの結果\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef mp(i):\n  print(\"type: \"+i)\n  dpu01=pt1.loc[pt1[\"type\"]==i]\n  dpu02=dpu01['life'].values.tolist()\n  wb21 = Fit_Weibull_2P(failures=dpu02)\n  dpu03=pd.DataFrame({\"type\":[i],\"eta\":[wb21.alpha],\"m\":[wb21.beta]})\n  return dpu03\n\ndpu04=pd.concat((mp(r) for r in pt2[\"type\"]),ignore_index=True)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntype: a\n\u001b[1m\u001b[23m\u001b[4m\u001b[49m\u001b[39mResults from Fit_Weibull_2P (95% CI):\u001b[0m\nAnalysis method: Maximum Likelihood Estimation (MLE)\nOptimizer: TNC\nFailures / Right censored: 4/0 (0% right censored) \n\nParameter  Point Estimate  Standard Error  Lower CI  Upper CI\n    Alpha         5.30868        0.351929   4.66185   6.04527\n     Beta         7.97623          3.1118   3.71291   17.1349 \n\nGoodness of fit    Value\n Log-likelihood -4.32774\n           AICc  24.6555\n            BIC  11.4281\n             AD  3.03487 \n\ntype: b\n\u001b[1m\u001b[23m\u001b[4m\u001b[49m\u001b[39mResults from Fit_Weibull_2P (95% CI):\u001b[0m\nAnalysis method: Maximum Likelihood Estimation (MLE)\nOptimizer: TNC\nFailures / Right censored: 4/0 (0% right censored) \n\nParameter  Point Estimate  Standard Error  Lower CI  Upper CI\n    Alpha         3.05865        0.449056   2.29382   4.07848\n     Beta         3.61323         1.39996   1.69081   7.72139 \n\nGoodness of fit    Value\n Log-likelihood -4.90322\n           AICc  25.8064\n            BIC   12.579\n             AD  3.02246 \n```\n:::\n:::\n\n\n### まとめ結果\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndpu04\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  type     eta       m\n0    a 5.30868 7.97623\n1    b 3.05865 3.61323\n```\n:::\n:::\n\n\n\n## 参考サイト\n\n[Python package reliability - Fitting a specific distribution to data](https://reliability.readthedocs.io/en/latest/Fitting%20a%20specific%20distribution%20to%20data.html)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.0/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.5.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}