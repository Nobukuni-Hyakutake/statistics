---
title: "ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º"
author: "Nobukuni Hyakutake"
date: "2023-11-30"
date-format: "iso"
categories: [R]
image: "lake.jpeg"
---

![](lake.jpeg)

## power.prop.testã®ä½¿ã„æ–¹

### ç¬¬ä¸€ç¾¤ã®æ¯æ¯”çŽ‡ð‘1=100E-6ã€ç¬¬äºŒç¾¤ã®æ¯æ¯”çŽ‡ð‘2=500E-6ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®æ¯æ¯”çŽ‡ã®å·®ã®æ¤œå®šã®æ¤œå‡ºåŠ›

ã“ã“ã§ã¯ã€0.8ã®æ¤œå‡ºåŠ›ã«ç·šã‚’å¼•ãã€‚

> It is proposed here as a convention that, when the investigator has no other basis for setting the desired power value, the value .80 be used.

å‡ºå…¸: [Statistical Power Analysis for the Behavioral Sciences Second Edition](https://www.utstat.toronto.edu/~brunner/oldclass/378f16/readings/CohenPower.pdf)

```{r}
n <- seq(1,1E5,1000)
alpha <- 0.05
p1 <- 100E-6
p2 <- 500E-6
 
power <- power.prop.test(n = n, p1 = p1, p2 = p2, sig.level = alpha)
plot(power$n,power$power)
abline(h=0.8)
```

n=29423ã®ã¨ã

```{r}
n <- 29423
alpha <- 0.05
p1 <- 100E-6
p2 <- 500E-6
power <- power.prop.test(n = n, p1 = p1, p2 = p2, sig.level = alpha)
power$power
```

### ç¬¬ä¸€ç¾¤ã®æ¯æ¯”çŽ‡ð‘1=100E-6ã€ç¬¬äºŒç¾¤ã®æ¯æ¯”çŽ‡ð‘2=10000E-6ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®æ¯æ¯”çŽ‡ã®å·®ã®æ¤œå®šã®æ¤œå‡ºåŠ›

```{r}
n <- seq(1,1E4,100)
alpha <- 0.05
p1 <- 100E-6
p2 <- 10000E-6
 
power <- power.prop.test(n = n, p1 = p1, p2 = p2, sig.level = alpha)
plot(power$n,power$power)
abline(h=0.8)
```

### è¦³æ¸¬æ•°ð‘›=10ã€æ¯å¹³å‡ã®å·®ð›¿=0.1ã€æ¨™æº–åå·®ðœŽ=0.05ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®å¯¾å¿œã®ãªã„tæ¤œå®šã®æ¤œå‡ºåŠ›

```{r}
n <- seq(1,100)
alpha <- 0.05
delta <- 0.1
sd <- 0.05
 
power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha)
plot(power$n,power$power)
abline(h=0.8)
```

### è¦³æ¸¬æ•°ð‘›=10ã€æ¯å¹³å‡ã®å·®ð›¿=0.01ã€æ¨™æº–åå·®ðœŽ=0.05ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®å¯¾å¿œã®ãªã„tæ¤œå®šã®æ¤œå‡ºåŠ›

```{r}
n <- seq(1,1e3)
alpha <- 0.05
delta <- 0.01
sd <- 0.05

power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha)
plot(power$n,power$power)
abline(h=0.8)
```

n=392ã®ã¨ãã®æ¤œå‡ºåŠ›

```{r}
n <- 392
alpha <- 0.05
delta <- 0.01
sd <- 0.05
power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha)
power$power
```

### è¦³æ¸¬æ•°ð‘›=10ã€æ¯å¹³å‡ã®å·®ð›¿=0.1ã€æ¨™æº–åå·®ðœŽ=0.05ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®å¯¾å¿œã®ã‚ã‚‹tæ¤œå®šã®æ¤œå‡ºåŠ›

```{r}
n <- seq(1,100)
alpha <- 0.05
delta <- 0.1
sd <- 0.05
 
power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha,type="paired")
plot(power$n,power$power)
abline(h=0.8)
```

### è¦³æ¸¬æ•°ð‘›=10ã€æ¯å¹³å‡ã®å·®ð›¿=0.01ã€æ¨™æº–åå·®ðœŽ=0.05ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã®ã¨ãã®å¯¾å¿œã®ã‚ã‚‹tæ¤œå®šã®æ¤œå‡ºåŠ›

```{r}
n <- seq(1,1e3)
alpha <- 0.05
delta <- 0.01
sd <- 0.05

power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha,type="paired")
plot(power$n,power$power)
abline(h=0.8)
```

n=196ã®ã¨ãã®æ¤œå‡ºåŠ›

```{r}
n <- 196
alpha <- 0.05
delta <- 0.01
sd <- 0.05
power <- power.t.test(n = n, delta = delta, sd=sd, sig.level = alpha,type="paired")
power$power
```

## ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã®è¨ˆç®—

### å‰²åˆã®å·®ã®æ¤œå®š(ã‚«ã‚¤2ä¹—æ¤œå®š)

$$
n=\frac{\{Z(\alpha/2)\sqrt{2\overline{p}(1-\overline{p})}+Z(\beta)\sqrt{p_0(1-p_0)+p_1(1-p_1)}\}^2}{d^2}
$$

$$
\overline{p}=(p_0+p_1)/2
$$

#### ç¬¬ä¸€ç¾¤ã®æ¯æ¯”çŽ‡ð‘0=100E-6ã€ç¬¬äºŒç¾¤ã®æ¯æ¯”çŽ‡ð‘1=500E-6ã€ç¬¬ä¸€ã®éŽèª¤ð›¼=0.05ã€æ¤œå‡ºåŠ›0.8ã¨ã—ãŸã¨ãã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º

```{r}
alpha <- 0.05
p0 <- 100E-6
p1 <- 500E-6
power<-0.8
beta<-1-power
phat<-(p0+p1)/2
((-qnorm(alpha/2)*sqrt(2*phat*(1-phat))+(-qnorm(beta)*sqrt(p0*(1-p0)+p1*(1-p1))))^2)/((p1-p0)^2)
```



### å¯¾å¿œã®ãªã„tæ¤œå®šã®ã¨ãã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º

ä¸‹è¨˜ã§è¨ˆç®—ã™ã‚‹

$$
n=\frac{2\sigma^2\{Z(\alpha/2)+Z(\beta)\}^2}{d^2}
$$

#### æ¨™æº–åå·®0.05, æ¤œå‡ºã™ã¹ãå·®ã‚’0.01,æ¤œå‡ºåŠ›0.8ã€$\alpha$ã‚’ä¸¡å´5%ã€æ¤œå‡ºåŠ›$1-\beta$ã‚’80%ã¨ã—ãŸå ´åˆ

```{r}
power<-0.8
alpha <- 0.05
delta <- 0.01
sd <- 0.05
(2*(sd^2)*(-qnorm(alpha/2)+(-qnorm(1-power)))^2)/(delta^2)
```


### å¯¾å¿œã®ã‚ã‚‹tæ¤œå®šã®ã¨ãã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º

ä¸‹è¨˜ã§è¨ˆç®—ã™ã‚‹

$$
n=\frac{\sigma^2\{Z(\alpha/2)+Z(\beta)\}^2}{d^2}
$$

#### æ¨™æº–åå·®0.05, æ¤œå‡ºã™ã¹ãå·®ã‚’0.01,æ¤œå‡ºåŠ›0.8ã€$\alpha$ã‚’ä¸¡å´5%ã€æ¤œå‡ºåŠ›$1-\beta$ã‚’80%ã¨ã—ãŸå ´åˆ

```{r}
power<-0.8
alpha <- 0.05
delta <- 0.01
sd <- 0.05
((sd^2)*(-qnorm(alpha/2)+(-qnorm(1-0.8)))^2)/(delta^2)
```

## å‚è€ƒæ–‡çŒ®

- [Rè¨€èªžã€€æ¤œå‡ºåŠ›ãƒ»ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã€€tæ¤œå®šã‚„æ¯æ¯”çŽ‡ã®æ¤œå®šã®æ¤œå‡ºåŠ›ã®è¨ˆç®—](https://multivariate-statistics.com/2021/10/16/r-programming-power-sample-size/)
- [ã€pythonã§çµ±è¨ˆå­¦ã€‘çµ±è¨ˆæ¤œå®šã®ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã™ã‚‹](https://python-man.club/sample_size/)
- [ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã®è¨­è¨ˆ](https://iss.ndl.go.jp/books/R100000002-I000011064467-00)
- [power.t.test() : 1ç¾¤ã¾ãŸã¯2ç¾¤ã®tæ¤œå®šã®ãƒ‘ãƒ¯ãƒ¼è¨ˆç®—ã‚’ã™ã‚‹é–¢æ•°](https://clover.fcg.world/2016/06/15/5302/)

## R version

```{r}
R.version.string
```